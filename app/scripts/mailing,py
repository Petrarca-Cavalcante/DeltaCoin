import smtplib
import ssl
from email.message import EmailMessage


def enviar_email(destinatario, assunto, corpo, caminho_anexo):
    # Dados do remetente
    remetente = "pedropetrarcar@gmail.com"
    senha = "XXXXXXX"  # veja abaixo como obter

    # Cria a mensagem
    mensagem = EmailMessage()
    mensagem["From"] = remetente
    mensagem["To"] = destinatario
    mensagem["Subject"] = assunto
    mensagem.set_content(corpo)

    # Lê e anexa o PDF
    with open(caminho_anexo, "rb") as f:
        conteudo = f.read()
        nome_arquivo = f.name.split("/")[-1]
        mensagem.add_attachment(
            conteudo, maintype="application", subtype="pdf", filename=nome_arquivo
        )

    # Envia via SMTP Gmail
    contexto = ssl.create_default_context()
    with smtplib.SMTP_SSL("smtp.gmail.com", 465, context=contexto) as servidor:
        servidor.login(remetente, senha)
        servidor.send_message(mensagem)

    print("E-mail enviado com sucesso!")


# Exemplo de uso
enviar_email(
    destinatario="pedropetrarcar@gmail.com",
    assunto="Relatório em PDF",
    corpo="Segue em anexo o relatório.",
    caminho_anexo="docs_generated/dataframe_saida.pdf",
)
